### Task outcome report using Gradle Enterprise API
Utility to generate reports based in the task outcome using the [Gradle Enterprise API](https://docs.gradle.com/enterprise/api-manual/)
It generates a report grouping by task outcome

#### Installation

After cloning the repository, execute:
```
./gradlew install
```

Test the binary with:
```
geapi/build/install/geapi/bin/geapi --help
```

#### Access Key and Permission
To access the Gradle Enterprise API you need to generate a new API token and the permission Access build data via the API:
1. Sign in to Gradle Enterprise.
2. Access "My settings" from the user menu in the top right-hand corner of the page.
3. Access "Access keys" from the left-hand menu.
4. Click "Generate" on the right-hand side and copy the generated access key.
5. Store the token in a file to be used later

To view the permissions assigned to you:
1. Sign in to Gradle Enterprise.
2. Access "My settings" from the user menu in the top right-hand corner of the page.
3. Access "Permissions" from the left-hand menu.
4. Check if you have the required permissions.

#### Reports
| Name              | Description                                                                      |
|-------------------|----------------------------------------------------------------------------------|
| TaskOutcomeReport | Group task outcome                                                               |
| BuildReport       | Retrieve Build Scans and display information by project and task execution       |
| BuildAnalyzer     | Display information by project and task execution from a given build bundle file |
| BuildExtractor    | Generates a build bundle file                                                    |
| ExperimentReport  | Retrieve and compare Build Scans generated by experiments                        |

#### Parameters

| Name                  | Description                                  | Default   | Required | Example                                  |
|-----------------------|----------------------------------------------|-----------|----------|------------------------------------------|
| api-key               | String token                                 |           | Yes      | --api-key=TOKEN_FILE                     |
| url                   | Gradle Enterprise instance                   |           | Yes      | --url=https://ge.acme.dev                |
| max-builds            | Max builds to be processed                   | 10        | No       | --max-builds=50                          |
| project               | Root project in Gradle Enterprise            |           | No       | --project=acme                           |
| include-failed-builds | Include failed builds in the report          | false     | No       | --include-failed-builds                  |
| task                  | Requested task                               |           | No       | --task=assemble                          |
| type                  | Type of task                                 |           | No       | --type=org.gradle.api.tasks.testing.Test |
| tags                  | Tags                                         | CI, LOCAL | No       | --tags=CI=develop                        |
| range                 | Initial date for requesting builds           | week      | No       | --range=month                            |
| since-build-id        | Initial build scan id for requesting builds  |           | No       | --since-build-id=xxxxxx                  |
| user                  | Author of the Build Scan                     |           | No       | --user=marc                              |
| build-support-file    | File generated by Build Extractor            |           | No       | --build-support-file=1builds.bundle      |
| experimentId          | Experiment identifier to process Build scans |           | No       | --experiment-id=${{github.run_number}}   |
| concurrent-calls      | Max allowed concurrent request               |           | No       | --concurrent-calls=20                    |

#### Examples

##### Task Outcome by type and project
```
 geapi/build/install/geapi/bin/geapi --api-key=$TOKEN \
       --report=taskOutcome \
       --url=https://ge.acme.dev \
       --type=org.jetbrains.kotlin.gradle.tasks.KotlinCompile
       --project=nowinandroid
       --max-builds=1000
       --concurrent-calls=20
```
##### General Task Outcome
```
 geapi/build/install/geapi/bin/geapi --api-key=$TOKEN \
       --report=taskOutcome \
       --url=https://ge.acme.dev \
       --max-builds=1000
       --concurrent-calls=20
```

##### Build Report
```
 geapi/build/install/geapi/bin/geapi --api-key=$TOKEN \
       --report=buildReport \
       --url=https://ge.acme.dev \
       --max-builds=1000
       --concurrent-calls=20
```
##### Extract Builds
```
 geapi/build/install/geapi/bin/geapi --api-key=$TOKEN \
       --report=buildExtractor \
       --url=https://ge.acme.dev \
       --max-builds=1000
       --concurrent-calls=20
```
##### Analyze Builds from File
```
 geapi/build/install/geapi/bin/geapi --api-key=$TOKEN \
       --report=buildAnalyzer \
       --url=https://ge.acme.dev \
       --build-support-file=XXXXX
```
##### Experiment
```
 geapi/build/install/geapi/bin/geapi --api-key=$TOKEN \
       --report=experiment \
       --url=https://ge.acme.dev \
       --task=assembleDebug \
       --max-builds=100  \
       --tags=main --tags=experiment --tags=pr --tags=${{github.run_number}} --experiment-id=${{github.run_number}} \
       --project=nowinandroid
```

#### Example Output
The execution will generate reports like:

```
┌───────────────────────────────────────────────┐
│             Gradle Enterprise API             │
├───────────────────────┬───────────────────────┤
│        Server         │https://ge.acme.dev    │
├───────────────────────┼───────────────────────┤
│      Report type      │         xxxx          │
├───────────────────────┼───────────────────────┤
│       MaxBuilds       │          10           │
├───────────────────────┼───────────────────────┤
│Including Failed builds│         false         │
├───────────────────────┼───────────────────────┤
│         Tags          │       ci, local       │
├───────────────────────┼───────────────────────┤
│Total builds processed │          10           │
├───────────────────────┼───────────────────────┤
│ Total build filtered  │           7           │
├───────────────────────┼───────────────────────┤
│       Duration        │      18 seconds       │
└───────────────────────┴───────────────────────┘
┌─────────────────────────────────────────────────────────┐
│  Executions by outcome                                  │
├────────────────────────────┬────────────────────────────┤
│  no-source                 │  633                       │
├────────────────────────────┼────────────────────────────┤
│  avoided_up_to_date        │  485                       │
├────────────────────────────┼────────────────────────────┤
│  lifecycle                 │  697                       │
├────────────────────────────┼────────────────────────────┤
│  skipped                   │  23                        │
├────────────────────────────┼────────────────────────────┤
│  executed_cacheable        │  5                         │
├────────────────────────────┼────────────────────────────┤
│  executed_not_cacheable    │  1240                      │
├────────────────────────────┼────────────────────────────┤
│  avoided_from_local_cache  │  1406                      │
├────────────────────────────┴────────────────────────────┤
│  Duration by outcome(ms)                                │
├────────────────────────────┬────────────────────────────┤
│  no-source                 │  2 seconds                 │
├────────────────────────────┼────────────────────────────┤
│  avoided_up_to_date        │  1 seconds                 │
├────────────────────────────┼────────────────────────────┤
│  lifecycle                 │  72 milliseconds           │
├────────────────────────────┼────────────────────────────┤
│  skipped                   │  1 milliseconds            │
├────────────────────────────┼────────────────────────────┤
│  executed_cacheable        │  3 seconds                 │
├────────────────────────────┼────────────────────────────┤
│  executed_not_cacheable    │  1 minutes and 37 seconds  │
├────────────────────────────┼────────────────────────────┤
│  avoided_from_local_cache  │  1 minutes and 21 seconds  │
├────────────────────────────┴────────────────────────────┤
│  Mean time by outcome(ms)                               │
├────────────────────────────┬────────────────────────────┤
│  no-source                 │  3 milliseconds            │
├────────────────────────────┼────────────────────────────┤
│  avoided_up_to_date        │  3 milliseconds            │
├────────────────────────────┼────────────────────────────┤
│  lifecycle                 │  0 milliseconds            │
├────────────────────────────┼────────────────────────────┤
│  skipped                   │  0 milliseconds            │
├────────────────────────────┼────────────────────────────┤
│  executed_cacheable        │  669 milliseconds          │
├────────────────────────────┼────────────────────────────┤
│  executed_not_cacheable    │  78 milliseconds           │
├────────────────────────────┼────────────────────────────┤
│  avoided_from_local_cache  │  57 milliseconds           │
└────────────────────────────┴────────────────────────────┘
```

